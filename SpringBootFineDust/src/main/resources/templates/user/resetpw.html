<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<title>비밀번호 찾기</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<link rel="stylesheet" href="/css/user/SignupLogin.css" />
<link rel="stylesheet" href="/css/common.css" />

<style>
.hidden-section {
	display: none;
}
</style>
</head>

<div class="signup-login-page-container">


	<!-- 우측 로그인 폼 영역 -->

	<!-- 이메일/닉네임 확인 폼 -->
	<form id="identity-form">
		<div class="card-body p-md-5 text-black">
			<div class="signup-login-center-container">
				<div class="signup-login-head-title">
					<h3 class="signup-login-h3 mb-5">비밀번호 찾기</h3>
				</div>
				<div class="signup-login-middle-content" id="identity-section">
					<!-- 이메일 -->
					<div class="mb-4">
						<div
							class="signup-login-form-label mb-2 d-flex align-items-center">
							<label for="usrEmail" class="me-1 mb-0">이메일</label> <span
								style="color: #FF0858;">*</span>
						</div>
						<input type="text" id="usrEmail" name="usrEmail"
							placeholder="이메일을 입력하세요" maxlength="30"
							pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$"
							title="올바른 이메일 형식을 입력하세요."
							class="form-control form-control-lg signup-form-control" />
					</div>

					<!-- 닉네임 -->
					<div class="mb-4">
						<div
							class="signup-login-form-label mb-2 d-flex align-items-center">
							<label for="usrEmail" class="me-1 mb-0">닉네임</label> <span
								style="color: #FF0858;">*</span>
						</div>
						<input type="text" id="usrNick" name="usrNick"
							placeholder="닉네임을 입력하세요" maxlength="20"
							class="form-control form-control-lg signup-form-control" />
					</div>
				</div>
				<div class="signup-login-bottom-content">
					<!-- 확인 버튼 -->
					<div align="center">
						<button type="button" id="verify-btn"
							class="btn signup-login-next-btn btn-lg">확인</button>
					</div>
					<div
						style="display: grid; grid-template-columns: 1fr 1fr; column-gap: 20px; row-gap: 1px; align-items: center; text-align: right; width: fit-content; margin: 0 auto;">
						<div>계정이 이미 있나요?</div>
						<div style="text-align: left;">
							<a style="font-weight: 600" href="login">로그인</a>
						</div>
						<div>아직 계정이 없나요?</div>
						<div style="text-align: left;">
							<a style="font-weight: 600" href="signup">회원가입</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>

	<!-- 비밀번호 재설정 폼 -->
	<form id="reset-form" method="post" action="resetpw"
		class="hidden-section">

		<div class="card-body text-black">
			<div class="signup-login-center-container">
				<div class="signup-login-head-title">
					<h3 class="signup-login-h3 mb-5">비밀번호 재설정</h3>
				</div>

				<div id="userIdContainer"></div>

				<div class="signup-login-middle-content" id="password-section">
					<!-- 새 비밀번호 -->
					<div class="mb-4">
						<div class="signup-login-form-label mb-2">
							<label for="usrPw">새 비밀번호</label> <span style="color: #FF0858;">*</span>
						</div>
						<input type="password" id="usrPw" name="usrPw"
							placeholder="새 비밀번호를 입력해주세요" required maxlength="20"
							class="form-control form-control-lg signup-form-control" />
					</div>

					<!-- 비밀번호 확인 -->
					<div class="mb-4">
						<div class="signup-login-form-label mb-2">
							<label for="usrPwCheck">비밀번호 확인</label> <span
								style="color: #FF0858;">*</span>
						</div>
						<input type="password" id="usrPwCheck" name="usrPwCheck"
							placeholder="비밀번호를 다시 입력해주세요" required maxlength="20"
							class="form-control form-control-lg signup-form-control" />
					</div>

				</div>
				<div class="signup-login-bottom-content">
					<div align="center">
						<button type="submit" class="btn signup-login-next-btn btn-lg">재설정</button>
					</div>
					<div
						style="display: grid; grid-template-columns: 1fr 1fr; column-gap: 20px; row-gap: 1px; align-items: center; text-align: right; width: fit-content; margin: 0 auto;">
						<div>계정이 이미 있나요?</div>
						<div style="text-align: left;">
							<a style="font-weight: 600" href="login">로그인</a>
						</div>
						<div>아직 계정이 없나요?</div>
						<div style="text-align: left;">
							<a style="font-weight: 600" href="signup">회원가입</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</form>

</div>
<!-- signup-page-container -->

<script>
	$('#verify-btn')
			.on(
					'click',
					function() {

						const usrEmail = $('#usrEmail').val();
						const usrNick = $('#usrNick').val();

						console.log(usrNick);

						if (!usrEmail) {
							alert("닉네임을 입력해 주세요.");
							return;
						}

						if (!usrNick) {
							alert("닉네임을 입력해 주세요.");
							return;
						}

						$
								.ajax({
									type : "POST",
									url : "/checkEmailNick",
									contentType : "application/json",
									data : JSON.stringify({
										"usrEmail" : usrEmail,
										"usrNick" : usrNick,
									}),
									dataType : "text",
									success : function(response) {
										if (response === "success") {

											let html = '';
											html += '<input type="hidden" id="usrEmail" name="usrEmail" value="' + usrEmail + '">';
											document
													.getElementById("userIdContainer").innerHTML = html;

											$('#identity-form').hide();
											$('#reset-form').show();

										} else {
											alert("일치하는 사용자가 없습니다.");
										}
									},

									error : function(xhr, status, error) {
										alert("서버 오류: " + error);
									}
								});
					});

	document.getElementById('reset-form').addEventListener('submit',
			function(e) {
				e.preventDefault();
				const usrPw = document.getElementById('usrPw').value;
				const usrPwCheck = document.getElementById('usrPwCheck').value;

				// 잘못된 조건 수정
				if ((usrPw.length < 8) || (usrPw.length > 20)) {
					alert("비밀번호는 8~20자로 입력해 주세요.");
					return;
				}

				if (usrPw != usrPwCheck) {
					alert("비밀번호가 일치하지 않습니다.");
					return;
				}

				this.submit();
			});
</script>

</body>
</html>