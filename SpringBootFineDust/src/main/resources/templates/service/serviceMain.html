<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ApexCharts 및 Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-apexcharts"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- 차트 컴포넌트 스타일/스크립트 -->
<link rel="stylesheet" href="./css/Common.css" />
<link rel="stylesheet" href="./css/service/sideBar.css" />
<link rel="stylesheet" href="./css/service/serviceMain.css">
<link rel="stylesheet" href="./css/service/header.css">

<!-- 부트스트랩 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

<script src="./js/logout.js"></script>
<script>
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20171210/classList.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/findindex_polyfill_mdn"><\/script>')
</script>
<script th:inline="javascript">
	window.model = {
		userName : '[[${userName}]]',
		headerText : '실내공기질 측정 시스템'
	};
</script>
<title>실내공기질 측정시스템</title>
</head>
<body>
	<script src="/js/sideBar.js"></script>


	<div class="service-main-page">
		<div id="sidebar-container"></div>
		<main class="serviceChart-main-content">
			<div id="serviceChart-header">
				<!-- js를 통해 여기에 헤더를 만들어 둠. -->
				<!-- 헤더에는 '실내공기질 측정시스템'을 포함하여 '마이페이지', '알림', '로그아웃' 기능이 들어 있음. -->
			</div>
			<div id="notificationDropdown" class="notification-dropdown hidden">
				<div class="notificationDropdown_header">
					<div class="notificationDropdown_close">
						<button class="notificationDropdown_close_btn"
							onclick="notificationDropdown_close()">
							<h4>
								<i class="fas fa-times"></i>
							</h4>

						</button>
					</div>
					<div class="notificationDropdown_header_txt">
						<h3>오류 알림</h3>
					</div>
				</div>
				<!-- 여기서부터 -->
				<div class="notification-card error">
					<div class="notification-title-box">
						<div class="notification-title-left-box">
							<div class="notification-title-icon">
								<i class="bi-exclamation-triangle-fill"></i>
							</div>
							<div class="notification-title-content">교대역 센서 오류</div>
						</div>
						<div class="notification-title-time">3시간 전</div>
					</div>
					<ul class="notification-content-box">
						<li class="notification-time">시간: 2024.04.13 15:20</li>
						<li class="notification-content">오류 내용: 미세먼지 값 수신 안됨</li>
						<li class="notification-state">상태: 점검 대기중</li>
					</ul>
				</div>
				<div class="notification-card error">
					<div class="notification-title-box">
						<div class="notification-title-left-box">
							<div class="notification-title-icon">
								<i class="bi-exclamation-triangle-fill"></i>
							</div>
							<div class="notification-title-content">교대역 센서 오류</div>
						</div>
						<div class="notification-title-time">3시간 전</div>
					</div>
					<ul class="notification-content-box">
						<li class="notification-time">시간: 2024.04.13 15:20</li>
						<li class="notification-content">오류 내용: 미세먼지 값 수신 안됨</li>
						<li class="notification-state">상태: 점검 대기중</li>
					</ul>
				</div>
				<div class="notification-card error">
					<div class="notification-title-box">
						<div class="notification-title-left-box">
							<div class="notification-title-icon">
								<i class="bi-exclamation-triangle-fill"></i>
							</div>
							<div class="notification-title-content">교대역 센서 오류</div>
						</div>
						<div class="notification-title-time">3시간 전</div>
					</div>
					<ul class="notification-content-box">
						<li class="notification-time">시간: 2024.04.13 15:20</li>
						<li class="notification-content">오류 내용: 미세먼지 값 수신 안됨</li>
						<li class="notification-state">상태: 점검 대기중</li>
					</ul>
				</div>
				<!-- 여기까지 실제 DB에서 데이터를 불러와서 출럭을 해야 됨. 즉 db에 값이 있으면 위의 코드를 반복하는 것 -->
			</div>

			<div class="serviceChart-headeroption">
				<select class="serviceChart-select">
					<th:block th:each="station : ${stationList}">
						<option
							th:text="${#strings.isEmpty(station.stName_1) ? '' : station.stName_1}"
							th:if="${!#strings.isEmpty(station.stName_1)}"></option>
						<option
							th:text="${#strings.isEmpty(station.stName_2) ? '' : station.stName_2}"
							th:if="${!#strings.isEmpty(station.stName_2)}"></option>
						<option
							th:text="${#strings.isEmpty(station.stName_3) ? '' : station.stName_3}"
							th:if="${!#strings.isEmpty(station.stName_3)}"></option>
					</th:block>
				</select> <input type="datetime-local" class="serviceChart-date" />
				<button class="serviceChart-button"
				        th:onclick="'getStationDust(' + ${stationList.stId} + ')'">
				    예측 vs 실제
				</button>

				<div class="serviceChart-buttons">
					<button class="serviceChart-button">미세먼지</button>
					<button class="serviceChart-button">유해가스</button>
				</div>
			</div>

			<div class="serviceChart-chart-top">
				<div class="serviceChart-chart-top-left">
					<!-- 예측 vs 실제 차트 -->
					<div id="app" class="serviceChart-box">
						<div id="chart" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
				</div>

				<script src="/js/charts/chartMain.js"></script>
				<!--  span tag에 실제 값 기입하기 언젠가는,,  -->
				<!--  신호등   -->
				<div class="serviceChart-chart-top-right">

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM1.0 <span class="serviceChart-divider">|</span> <span
								class="pm-value">10</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm1"></div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM2.5 <span class="serviceChart-divider">|</span> <span
								class="pm-value">12</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm2"></div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM10 <span class="serviceChart-divider">|</span> <span
								class="pm-value">28</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm10"></div>
					</div>

				</div>
			</div>

			<div class="serviceChart-chart-bottom">
				<div class="serviceChart-chart-box">
					<!-- PM1.0 시간별 차트 -->
					<div id="app2" class="serviceChart-box">
						<div id="chart2" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm1.js"></script>
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM2.5 시간별 차트 -->
					<div id="app3" class="serviceChart-box">
						<div id="chart3" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm2_5.js"></script>
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM10 시간별 차트 -->
					<div id="app4" class="serviceChart-box">
						<div id="chart4" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm10.js"></script>
				</div>
			</div>
			<script type="text/javascript" src="./js/header.js"></script>
		</main>
	</div>
	<script>
	document.addEventListener('DOMContentLoaded', () => {
		  const input = document.querySelector('.serviceChart-date');

		  function updateKoreanDatetimeLocal() {
		    const now = new Date();
		    const krDate = new Date(now.getTime());

		    const year = krDate.getFullYear();
		    const month = String(krDate.getMonth() + 1).padStart(2, '0');
		    const day = String(krDate.getDate()).padStart(2, '0');
		    const hour = String(krDate.getHours()).padStart(2, '0');
		    const minute = String(krDate.getMinutes()).padStart(2, '0');

		    const formatted = `${year}-${month}-${day}T${hour}:${minute}`;

		    input.value = formatted;
		    input.max = formatted;
		  }

		  updateKoreanDatetimeLocal();

		  setInterval(() => {
		    const now = new Date();
		    if (now.getSeconds() === 0) {
		      updateKoreanDatetimeLocal();
		    }
		  }, 1000);
		});
	
	
	document.addEventListener('DOMContentLoaded', () => {
		  const pmBoxes = document.querySelectorAll('.pm-box');

		  pmBoxes.forEach(box => {
		    const type = box.getAttribute('data-type'); // pm1 / pm2 / pm10
		    const value = parseInt(box.querySelector('.pm-value').textContent);
		    const statusEl = box.querySelector('.pm-status');

		    let className = '';
		    let statusText = '';

		     
		    if (type === 'pm1') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    if (type === 'pm2') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    if (type === 'pm10') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    // 클래스 적용
		    box.classList.remove('serviceChart-good', 'serviceChart-moderate', 'serviceChart-bad');
		    box.classList.add(className);

		    // 상태 텍스트 적용
		    statusEl.textContent = ` (${statusText})`;
		  });
		});

		// 데이터 불러오는 함수
	const getStationDust = (stId) =>{
		alert(stId);
	    $.ajax({
	        url : "getStationDust",
	        type : "get",
	        data : { "stId" : stId }, 
	        success : function(data) {
	            console.log("불러온 데이터?? :", data);
	            // 받은 데이터 활용 코드 작성
	        },
	        error : function(err) {
	            console.error("데이터 불러오기 실패:", err);
	        }
	    });
	}
	
	</script>
</body>
</html>
