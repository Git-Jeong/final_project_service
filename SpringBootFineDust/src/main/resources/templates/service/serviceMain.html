<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ApexCharts 및 Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-apexcharts"></script>

<!-- 차트 컴포넌트 스타일/스크립트 -->
<link rel="stylesheet" href="./css/Common.css" />
<link rel="stylesheet" href="./css/service/sideBar.css" />
<link rel="stylesheet" href="./css/service/serviceMain.css">

<!-- 부트스트랩 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet">

<script src="./js/logout.js"></script>
<script>
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20171210/classList.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/findindex_polyfill_mdn"><\/script>')
</script>

<title>실내공기질 측정시스템</title>
</head>
<body>

	<script th:inline="javascript">
		window.model = {
			userName : '[[${userName}]]'
		};
	</script>
	<script src="/js/sideBar.js"></script>


	<div class="service-main-page">
		<div id="sidebar-container"></div>
		<main class="serviceChart-main-content">
			<div class="serviceChart-header">
				<div class="serviceChart-header-left">
					<h2>실내공기질 측정시스템</h2>
				</div>
				<div class="serviceChart-header-right">
					<button class="logout-button" onclick="goLogout()">
						<i class="bi-box-arrow-right logout-icon"></i>
					</button>
				</div>
			</div>

			<div class="serviceChart-headeroption">
				<select class="serviceChart-select">
					<option>서울역</option>
					<option>강남역</option>
					<option>신촌역</option>
				</select>
				<input type="datetime-local" class="serviceChart-date" />
				<button class="serviceChart-button">예측 vs 실제</button>
				<div class="serviceChart-buttons">
					<button class="serviceChart-button">미세먼지</button>
					<button class="serviceChart-button">유해가스</button>
				</div>
			</div>

			<div class="serviceChart-chart-top">
				<div class="serviceChart-chart-top-left">
					<!-- 예측 vs 실제 차트 -->
					<div id="app" class="serviceChart-box">
						<div id="chart" class="serviceChart_apexchart">
							<apexchart 
							  type="line" 
							  ref="chart" 
							  :options="chartOptions" 
							  :series="series" 
							  height="100%">
							</apexchart>
						</div>
					</div>
				</div>

				<script src="/js/charts/chartMain.js"></script>

				<div class="serviceChart-chart-top-right">
					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM1.0 <span class="serviceChart-divider">|</span> 10
							</li>
						</ul>
						<div class="serviceChart-quality serviceChart-pm1">Good</div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM2.5 <span class="serviceChart-divider">|</span> 12
							</li>
						</ul>
						<div class="serviceChart-quality serviceChart-pm2">Moderate</div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM10 <span class="serviceChart-divider">|</span> 28
							</li>
						</ul>
						<div class="serviceChart-quality serviceChart-pm10">Poor</div>
					</div>
				</div>
			</div>

			<div class="serviceChart-chart-bottom">
				<div class="serviceChart-chart-box">
					<!-- PM1.0 시간별 차트 -->
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM2.5 시간별 차트 -->
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM10 시간별 차트 -->
				</div>
			</div>
		</main>
	</div>
	<script>
	const input = document.querySelector('.serviceChart-date');

	function updateKoreanDatetimeLocal() {
	  // 한국 시간 문자열 ISO 형식 맞춤
	  const now = new Date();

	  // 한국 시간으로 변환 (toLocaleString + Asia/Seoul)
	  const krDateStr = now.toLocaleString('ko-KR', { timeZone: 'Asia/Seoul' });
	  const krDate = new Date(krDateStr);

	  // "YYYY-MM-DDTHH:mm" 포맷 만들기
	  const year = krDate.getFullYear();
	  const month = String(krDate.getMonth() + 1).padStart(2, '0');
	  const day = String(krDate.getDate()).padStart(2, '0');
	  const hour = String(krDate.getHours()).padStart(2, '0');
	  const minute = String(krDate.getMinutes()).padStart(2, '0');

	  const formatted = `${year}-${month}-${day}T${hour}:${minute}`;

	  input.value = formatted;
	  input.max = formatted;
	}

	// 최초 실행
	updateKoreanDatetimeLocal();

	// 매 분 0초에 갱신 (분 바뀔 때마다)
	setInterval(() => {
	  const now = new Date();
	  if (now.getSeconds() === 0) {
	    updateKoreanDatetimeLocal();
	  }
	}, 1000);

	</script>
</body>
</html>
