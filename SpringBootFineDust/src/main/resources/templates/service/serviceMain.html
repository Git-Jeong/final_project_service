<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- ApexCharts 및 Vue -->
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-apexcharts"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- 차트 컴포넌트 스타일/스크립트 -->
<link rel="stylesheet" href="/css/Common.css" />
<link rel="stylesheet" href="/css/service/ServiceMain.css">
<link rel="stylesheet" href="/css/service/ServiceCommon.css">

<!-- 부트스트랩 CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
	rel="stylesheet">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
	
<script>
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/promise-polyfill@8/dist/polyfill.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/eligrey-classlist-js-polyfill@1.2.20171210/classList.min.js"><\/script>')
	window.Promise
			|| document
					.write('<script src="https://cdn.jsdelivr.net/npm/findindex_polyfill_mdn"><\/script>')
</script>
<script th:inline="javascript">
	window.model = {
		userName : '[[${userName}]]',
		headerText : '측정 시스템'
	};
</script>
<script src="/js/service/ServiceGetData.js"></script> <!-- 여기서 먼지 데이터, 알림 데이터를 자동으로 불러오는 중 -->
<title>실내공기질 측정시스템</title>
</head>
<body>
	<script src="/js/service/ServiceSidebar.js"></script>


	<div class="service-main-page">
		<div id="sidebar-container"></div>
		<main class="serviceChart-main-content">
			<div id="serviceChart-header">
				<!-- js를 통해 여기에 헤더를 만들어 둠. -->
				<!-- 헤더에는 '실내공기질 측정시스템'을 포함하여 '마이페이지', '알림', '로그아웃' 기능이 들어 있음. -->
			</div>
			<div id="notificationDropdown" class="notification-dropdown hidden"> 
				<!-- 여기까지 실제 DB에서 데이터를 불러와서 출럭을 해야 됨. 즉 db에 값이 있으면 위의 코드를 반복하는 것 -->
				<!-- js를 통해 여기에 알림 베너를 만들어 둠. -->
			</div>

			<div class="serviceChart-headeroption">
				<select class="serviceChart-select">
					<th:block th:each="station : ${stationList}">
						<option
							th:text="${#strings.isEmpty(station.stName_1) ? '' : station.stName_1}"
							th:if="${!#strings.isEmpty(station.stName_1)}"></option>
						<option
							th:text="${#strings.isEmpty(station.stName_2) ? '' : station.stName_2}"
							th:if="${!#strings.isEmpty(station.stName_2)}"></option>
						<option
							th:text="${#strings.isEmpty(station.stName_3) ? '' : station.stName_3}"
							th:if="${!#strings.isEmpty(station.stName_3)}"></option>
					</th:block>
				</select> <input type="datetime-local" class="serviceChart-date" />
				<button id="serviceChartSearchButton" class="serviceChart-button" style="visibility: hidden;"
				        th:onclick="'getStationDust(' + ${stationList.stId} + ')'">
				    검색
				</button> 
			</div>

			<div class="serviceChart-chart-top">
				<div class="serviceChart-chart-top-left">
					<!-- 예측 vs 실제 차트 -->
					<div id="app" class="serviceChart-box">
						<div id="chart" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
				</div>

				<script src="/js/charts/chartMain.js"></script>
				<!--  span tag에 실제 값 기입하기 언젠가는,,  -->
				<!--  신호등   -->
				<div class="serviceChart-chart-top-right">
					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM1.0 <span class="serviceChart-divider">|</span> <span
								class="pm-value">10</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm1"></div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM2.5 <span class="serviceChart-divider">|</span> <span
								class="pm-value">12</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm2"></div>
					</div>

					<div class="serviceChart-air-quality-box">
						<ul class="serviceChart-pmbold">
							<li>PM10 <span class="serviceChart-divider">|</span> <span
								class="pm-value">28</span></li>
						</ul>
						<div class="serviceChart-quality" data-type="pm10"></div>
					</div>

				</div>
			</div>

			<div class="serviceChart-chart-bottom">
				<div class="serviceChart-chart-box">
					<!-- PM1.0 시간별 차트 -->
					<div id="app2" class="serviceChart-box">
						<div id="chart2" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm1.js"></script>
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM2.5 시간별 차트 -->
					<div id="app3" class="serviceChart-box">
						<div id="chart3" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm2_5.js"></script>
				</div>
				<div class="serviceChart-chart-box">
					<!-- PM10 시간별 차트 -->
					<div id="app4" class="serviceChart-box">
						<div id="chart4" class="serviceChart_apexchart">
							<apexchart type="line" ref="chart" :options="chartOptions"
								:series="series" height="100%"> </apexchart>
						</div>
					</div>
					<script src="/js/charts/chartpm10.js"></script>
				</div>
			</div>
			<script type="text/javascript" src="/js/service/ServiceHeader.js"></script>
		</main>
	</div>
	<script>  
	
	document.addEventListener('DOMContentLoaded', () => {
		  const pmBoxes = document.querySelectorAll('.pm-box');

		  pmBoxes.forEach(box => {
		    const type = box.getAttribute('data-type'); // pm1 / pm2 / pm10
		    const value = parseInt(box.querySelector('.pm-value').textContent);
		    const statusEl = box.querySelector('.pm-status');

		    let className = '';
		    let statusText = '';

		     
		    if (type === 'pm1') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    if (type === 'pm2') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    if (type === 'pm10') {
		      if (value <= 30) {
		        className = 'serviceChart-good';
		        statusText = '좋음';
		      } else if (value <= 60) {
		        className = 'serviceChart-moderate';
		        statusText = '보통';
		      } else {
		        className = 'serviceChart-bad';
		        statusText = '나쁨';
		      }
		    }

		    // 클래스 적용
		    box.classList.remove('serviceChart-good', 'serviceChart-moderate', 'serviceChart-bad');
		    box.classList.add(className);

		    // 상태 텍스트 적용
		    statusEl.textContent = ` (${statusText})`;
		  });
		});


	</script>
</body>
</html>
